CREATE  DATABASE CRMS;
USE CRMS;

CREATE TABLE CATEGORY (
CName VARCHAR(20),
No_of_Persons INT NOT NULL,
CategoryId INT NOT NULL,
LCapacity INT NOT NULL,
Cost_Per_Day FLOAT NOT NULL,
PRIMARY KEY(CategoryId)
);
CREATE TABLE CAR(
ModelY INT NOT NULL,
Model VARCHAR(20) NOT NULL,
Last_Service DATE NOT NULL,
Mileage INT NOT NULL,
CategoryId  INT,
FOREIGN KEY(CategoryId) REFERENCES CATEGORY(CategoryId),
RNo VARCHAR(20),
PRIMARY KEY (RNo) 
);

CREATE TABLE CUSTOMER (
PName VARCHAR (20) NOT NULL,
DLNumber VARCHAR (20) NOT NULL,
Email VARCHAR (20) NOT NULL,
Address VARCHAR (40) NOT NULL,
PhoneNo NUMERIC  NOT NULL,
MemberId INT,
PRIMARY KEY (MemberId)
);

CREATE TABLE LOCATION (
LName VARCHAR (20) NOT NULL,
Loc_Id INT,
LAddress VARCHAR (40) NOT NULL,
PRIMARY KEY(Loc_Id) 
);

CREATE TABLE INSURANCE (
IName VARCHAR(20) NOT NULL,
Coverage_type VARCHAR (20) NOT NULL,
Insurance_Expiry DATE NOT NULL,
Insurance_Id VARCHAR(20),
PRIMARY KEY (Insurance_Id)
);

CREATE TABLE BOOKING(
ReturnD DATE NOT NULL,
BookD DATE NOT NULL,
MemberId INT,
FOREIGN KEY (MemberId) REFERENCES CUSTOMER(MemberId),
Loc_Id INT ,
FOREIGN KEY (Loc_Id) REFERENCES LOCATION(Loc_Id),
Insurance_Id VARCHAR(20),
FOREIGN KEY (Insurance_Id) REFERENCES INSURANCE(Insurance_Id),
Book_Id VARCHAR(20),
PRIMARY KEY (Book_Id),
RNo VARCHAR(20),
FOREIGN KEY (RNo) REFERENCES CAR(RNo),
Amt FLOAT
);


CREATE TABLE BILL(
Bill_Id VARCHAR(20),
Service_Fee FLOAT ,
Total_Amount FLOAT ,
Bill_Date DATE NOT NULL,
Book_Id VARCHAR(20),
PRIMARY KEY (Bill_Id),
FOREIGN KEY (Book_Id) REFERENCES BOOKING(Book_Id)
);

/*inserting values*/
INSERT INTO CATEGORY VALUES('HATCHBACK',4,1,230,850);
INSERT INTO CATEGORY VALUES('SEDAN',5,2,400,1050);
INSERT INTO CATEGORY VALUES('SUV',7,3,500,1500);
INSERT INTO CATEGORY VALUES('LUXURY',5,4,450,2000);
INSERT INTO CATEGORY VALUES('CABRIOLET',5,5,300,5000);

INSERT INTO CAR VALUES(2015,'I20',STR_TO_DATE('10-01-2020', '%d-%m-%Y'),50000,1,'KA-02-SK-7600');
INSERT INTO CAR VALUES(2016,'POLO',STR_TO_DATE('10-03-2020', '%d-%m-%Y'),40000,1,'KA-02-SR-8055');
INSERT INTO CAR VALUES(2014,'HONDA CITY',STR_TO_DATE('24-12-2019', '%d-%m-%Y'),60000,2,'KA-03-MP-1234');
INSERT INTO CAR VALUES(2017,'COROLLA',STR_TO_DATE('15-10-2019', '%d-%m-%Y'),30000,2,'KA-04-MH-7860');
INSERT INTO CAR VALUES(2018,'BREZZA',STR_TO_DATE('03-02-2020', '%d-%m-%Y'),20000,3,'KA-02-MH-4722');
INSERT INTO CAR VALUES(2017,'INNOVA',STR_TO_DATE('07-05-2020', '%d-%m-%Y'),35000,3,'KA-05-CN-3210');
INSERT INTO CAR VALUES(2019,'AUDI A4',STR_TO_DATE('15-12-2020', '%d-%m-%Y'),10000,4,'KA-01-LX-007');

INSERT INTO CUSTOMER VALUES('RAJKUMAR','KA02 1234','rajkumar@abc.com','RAJAJINAGAR','6362319011',1001);
INSERT INTO CUSTOMER VALUES('ROHAN','KA02 4321','rohan@abc.com','BASAVESHWARNAGAR','7349726140',1002);
INSERT INTO CUSTOMER VALUES('TUSHARA','KA01 4567','tushara@abc.com','CHANDRA LAYOUT','9844655540',1003);
INSERT INTO CUSTOMER VALUES('SPANDANA','KA03 0678','spandana@abc.com','HEBBAL','8904575820',1004);
INSERT INTO CUSTOMER VALUES('SRIVATSA','KA04 9867','srivatsa@xyz.com','INDIRANAGAR','8296414286 ',1005);
INSERT INTO CUSTOMER VALUES('RAHUL','KA41 4532','rahul@xyz.com','KENGERI','9663131168',1006);
INSERT INTO CUSTOMER VALUES('SHASHANK','KA02 0510','shashank@xyz.com','BASAVESHWARNAGAR','9513801692',1007);

INSERT INTO LOCATION VALUES ('CRMS-NAGARBHAVI',101,'NAGARBHAVI');
INSERT INTO LOCATION VALUES ('CRMS-RAJAJINAGAR',102,'RAJAJINAGAR');
INSERT INTO LOCATION VALUES ('CRMS-WHITEFIELD',103,'WHITEFIELD');
INSERT INTO LOCATION VALUES ('CRMS-MAJESTIC',104,'MAJESTIC');

INSERT INTO INSURANCE VALUES('EDELWEISS','CTP',STR_TO_DATE('10-01-2021', '%d-%m-%Y'),'E01');
INSERT INTO INSURANCE VALUES('ICICI','CI',STR_TO_DATE('07-03-2021', '%d-%m-%Y'),'I01');
INSERT INTO INSURANCE VALUES('KOTAK','FTO',STR_TO_DATE('15-03-2021', '%d-%m-%Y'),'K01');
INSERT INTO INSURANCE VALUES('EDELWEISS','CTP',STR_TO_DATE('18-05-2021', '%d-%m-%Y'),'E02');
INSERT INTO INSURANCE VALUES('ICICI','CI',STR_TO_DATE('19-10-2021', '%d-%m-%Y'),'I02');
INSERT INTO INSURANCE VALUES('KOTAK','FTO',STR_TO_DATE('02-06-2021', '%d-%m-%Y'),'K02');
INSERT INTO INSURANCE VALUES('EDELWEISS','CTP',STR_TO_DATE('05-10-2021', '%d-%m-%Y'),'E03');

INSERT INTO BOOKING (ReturnD,BookD,MemberId,Loc_Id,Insurance_Id,Book_Id,RNo) VALUES (STR_TO_DATE('09-03-2020', '%d-%m-%Y'),STR_TO_DATE('13-03-2020', '%d-%m-%Y'),1002,101,'E01','CRMS01','KA-02-SK-7600');
INSERT INTO BOOKING (ReturnD,BookD,MemberId,Loc_Id,Insurance_Id,Book_Id,RNo) VALUES (STR_TO_DATE('17-04-2020', '%d-%m-%Y'),STR_TO_DATE('24-04-2020', '%d-%m-%Y'),1003,102,'E02','CRMS02','KA-03-MP-1234');
INSERT INTO BOOKING (ReturnD,BookD,MemberId,Loc_Id,Insurance_Id,Book_Id,RNo) VALUES (STR_TO_DATE('21-05-2020', '%d-%m-%Y'),STR_TO_DATE('22-05-2020', '%d-%m-%Y'),1001,103,'E03','CRMS03','KA-01-LX-007');
INSERT INTO BOOKING (ReturnD,BookD,MemberId,Loc_Id,Insurance_Id,Book_Id,RNo) VALUES (STR_TO_DATE('15-11-2020', '%d-%m-%Y'),STR_TO_DATE('20-11-2020', '%d-%m-%Y'),1004,101,'I01','CRMS04','KA-04-MH-7860');
INSERT INTO BOOKING (ReturnD,BookD,MemberId,Loc_Id,Insurance_Id,Book_Id,RNo) VALUES (STR_TO_DATE('02-03-2020', '%d-%m-%Y'),STR_TO_DATE('06-03-2020', '%d-%m-%Y'),1007,102,'E01','CRMS05','KA-02-SK-7600');
INSERT INTO BOOKING (ReturnD,BookD,MemberId,Loc_Id,Insurance_Id,Book_Id,RNo) VALUES (STR_TO_DATE('02-10-2020', '%d-%m-%Y'),STR_TO_DATE('07-10-2020', '%d-%m-%Y'),1005,104,'K01','CRMS06','KA-05-CN-3210');
INSERT INTO BOOKING (ReturnD,BookD,MemberId,Loc_Id,Insurance_Id,Book_Id,RNo) VALUES (STR_TO_DATE('12-12-2020', '%d-%m-%Y'),STR_TO_DATE('24-12-2020', '%d-%m-%Y'),1006,101,'K02','CRMS07','KA-02-MH-4722');
INSERT INTO BOOKING (ReturnD,BookD,MemberId,Loc_Id,Insurance_Id,Book_Id,RNo) VALUES (STR_TO_DATE('28-11-2020', '%d-%m-%Y'),STR_TO_DATE('01-12-2020', '%d-%m-%Y'),1007,103,'I02','CRMS08','KA-02-SR-8055');

INSERT INTO BILL (Bill_Id,Service_Fee,Bill_Date,Book_Id) VALUES ('B101',200,STR_TO_DATE('13-03-2020', '%d-%m-%Y'),'CRMS01');
INSERT INTO BILL (Bill_Id,Service_Fee,Bill_Date,Book_Id) VALUES ('B102',200,STR_TO_DATE('24-04-2020', '%d-%m-%Y'),'CRMS02');
INSERT INTO BILL (Bill_Id,Service_Fee,Bill_Date,Book_Id) VALUES ('B103',200,STR_TO_DATE('22-05-2020', '%d-%m-%Y'),'CRMS03');
INSERT INTO BILL (Bill_Id,Service_Fee,Bill_Date,Book_Id) VALUES ('B104',200,STR_TO_DATE('20-11-2020', '%d-%m-%Y'),'CRMS04');
INSERT INTO BILL (Bill_Id,Service_Fee,Bill_Date,Book_Id) VALUES ('B105',200,STR_TO_DATE('06-03-2020', '%d-%m-%Y'),'CRMS05');
INSERT INTO BILL (Bill_Id,Service_Fee,Bill_Date,Book_Id) VALUES ('B106',200,STR_TO_DATE('07-10-2020', '%d-%m-%Y'),'CRMS06');
INSERT INTO BILL (Bill_Id,Service_Fee,Bill_Date,Book_Id) VALUES('B107',200,STR_TO_DATE('24-12-2020', '%d-%m-%Y'),'CRMS07');
INSERT INTO BILL (Bill_Id,Service_Fee,Bill_Date,Book_Id) VALUES ('B108',200,STR_TO_DATE('01-12-2020', '%d-%m-%Y'),'CRMS08');


SELECT * FROM CATEGORY;
SELECT * FROM CAR;
SELECT * FROM CUSTOMER;
SELECT * FROM LOCATION;
SELECT * FROM INSURANCE;
SELECT * FROM BOOKING;
SELECT * FROM BILL;


/*queries*/
CREATE TABLE RESULT AS (SELECT CAR. RNo, CAR. CategoryId, CATEGORY. Cost_Per_Day FROM CATEGORY JOIN CAR ON CATEGORY. CategoryId=CAR. CategoryId); 
CREATE TABLE RESULT2 (SELECT BOOKING. RNo, RESULT. Cost_Per_Day *DATEDIFF (BookD, ReturnD) AS Amt FROM RESULT JOIN BOOKING ON BOOKING. RNo=RESULT. RNo);
UPDATE BOOKING AS t1
JOIN RESULT2 AS t2 ON t1. RNo= t2. RNo
SET t1. Amt = t2. Amt;
SELECT * FROM BOOKING;
-----------------------------------------------------------------------------------------
UPDATE BILL AS A
JOIN BOOKING AS B ON A. Book_Id = B. Book_Id 
SET A. Total_Amount = B. Amt + A. Service_Fee;
-----------------------------------------------------------------------------------------
DELETE FROM CATEGORY 
WHERE CategoryId NOT IN (SELECT CategoryId FROM CAR CATEGORY);
SELECT * FROM CATEGORY;
-----------------------------------------------------------------------------------------
UPDATE CUSTOMER 
SET Email = "srivatsa@abc.com" 
WHERE DLNumber="KA04 9867";
-----------------------------------------------------------------------------------------
SELECT IName,
COUNT(Insurance_Id) FROM INSURANCE 
GROUP BY IName;
-----------------------------------------------------------------------------------------
DROP TABLE BILL;
DROP TABLE BOOKING;
DROP TABLE INSURANCE;
DROP TABLE LOCATION;
DROP TABLE CUSTOMER;
DROP TABLE CAR;
DROP TABLE CATEGORY;
DROP TABLE RESULT;
DROP TABLE RESULT2;
-----------------------------------------------------------------------------------------
DESC BILL;
DESC BOOKING;
DESC INSURANCE;
DESC LOCATION;
DESC CUSTOMER;
DESC CAR;
DESC CATEGORY;
